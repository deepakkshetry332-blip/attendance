<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Attendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; touch-action: manipulation; background-color: #f8fafc; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const IconPlus = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconTrash = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const IconChevron = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const IconCheck = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconX = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconBack = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>;

        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-2xl shadow-sm border border-gray-100 p-4 ${className}`}>{children}</div>;
        const Button = ({ onClick, children, variant = "primary", className = "", size = "md" }) => {
            const base = "font-semibold rounded-xl transition-all active:scale-95 flex items-center justify-center gap-2";
            const v = { primary: "bg-blue-600 text-white shadow-lg shadow-blue-200", secondary: "bg-gray-100 text-gray-700", danger: "bg-red-50 text-red-600" };
            const s = { sm: "px-3 py-1.5 text-sm", md: "px-4 py-3", icon: "p-3" };
            return <button onClick={onClick} className={`${base} ${v[variant]} ${s[size]} ${className}`}>{children}</button>;
        };

        function App() {
            const [classes, setClasses] = useState(() => { const s = localStorage.getItem('classes'); return s ? JSON.parse(s) : []; });
            const [selClass, setSelClass] = useState(null);
            const [view, setView] = useState('list');
            const [newName, setNewName] = useState("");
            const [newStu, setNewStu] = useState("");
            useEffect(() => { localStorage.setItem('classes', JSON.stringify(classes)); }, [classes]);

            const addClass = () => { if (!newName.trim()) return; setClasses([...classes, { id: Date.now(), name: newName, students: [], sessions: [] }]); setNewName(""); };
            const delClass = (id) => { if (confirm("Delete?")) { setClasses(classes.filter(c => c.id !== id)); if (selClass?.id === id) setView('list'); } };
            const addStu = () => { if (!newStu.trim() || !selClass) return; const up = classes.map(c => c.id === selClass.id ? { ...c, students: [...c.students, { id: Date.now(), name: newStu }] } : c); setClasses(up); setSelClass(up.find(c => c.id === selClass.id)); setNewStu(""); };
            const saveAtt = (st) => { const sess = { id: Date.now(), date: new Date().toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'}), records: st }; const up = classes.map(c => c.id === selClass.id ? { ...c, sessions: [sess, ...c.sessions] } : c); setClasses(up); setSelClass(up.find(c => c.id === selClass.id)); setView('detail'); };

            if (view === 'list') return (
                <div className="max-w-md mx-auto min-h-screen px-6 pt-4 space-y-6">
                    <header><h1 className="text-3xl font-bold text-slate-900">My Classes</h1><p className="text-slate-500">Attendance Tracker</p></header>
                    <div className="flex gap-2"><input type="text" placeholder="Class Name" className="flex-1 px-4 py-3 rounded-xl border border-gray-200 outline-none" value={newName} onChange={e=>setNewName(e.target.value)} /><Button onClick={addClass} size="icon"><IconPlus /></Button></div>
                    <div className="grid gap-3">{classes.map(c => <Card key={c.id} className="relative active:bg-gray-50"><div className="absolute inset-0" onClick={()=>{setSelClass(c);setView('detail')}}></div><div className="flex justify-between items-center pointer-events-none"><div><h3 className="font-bold text-lg">{c.name}</h3><p className="text-sm text-slate-500">{c.students.length} Students</p></div><div className="flex items-center gap-3 pointer-events-auto"><button onClick={()=>delClass(c.id)} className="p-2 text-gray-300 hover:text-red-500"><IconTrash /></button><IconChevron /></div></div></Card>)}{classes.length===0 && <p className="text-center text-gray-400 py-10">No classes yet.</p>}</div>
                </div>
            );
            if (view === 'detail') return (
                <div className="max-w-md mx-auto min-h-screen px-6 pt-4 space-y-6">
                    <header className="flex items-center gap-2"><button onClick={()=>setView('list')} className="p-2 -ml-2"><IconBack /></button><h1 className="text-2xl font-bold">{selClass.name}</h1></header>
                    <div className="grid grid-cols-2 gap-3"><Button onClick={()=>setView('mark')} className="w-full">Mark Today</Button><Button variant="secondary" onClick={()=>setView('stats')} className="w-full">Stats</Button></div>
                    <div><div className="flex gap-2 mb-4"><input type="text" placeholder="Add Student" className="flex-1 px-4 py-2 rounded-xl border border-gray-200 outline-none" value={newStu} onChange={e=>setNewStu(e.target.value)} /><Button onClick={addStu} size="sm">Add</Button></div><div className="space-y-2">{selClass.students.map(s=><div key={s.id} className="flex justify-between p-3 bg-white rounded-xl border border-gray-100"><span className="font-medium">{s.name}</span></div>)}</div></div>
                </div>
            );
            if (view === 'mark') {
                const [st, setSt] = useState({});
                useEffect(() => { const i={}; selClass.students.forEach(s=>i[s.id]='present'); setSt(i); }, []);
                const tog = (id) => setSt(p=>({...p, [id]: p[id]==='present'?'absent':'present'}));
                const cnt = Object.values(st).filter(s=>s==='present').length;
                return (
                    <div className="max-w-md mx-auto min-h-screen px-6 pt-4 flex flex-col h-[90vh]">
                        <header className="flex justify-between items-center mb-6"><button onClick={()=>setView('detail')} className="text-gray-500">Cancel</button><div className="font-bold">New Session</div><button onClick={()=>saveAtt(st)} className="text-blue-600 font-bold">Save</button></header>
                        <div className="bg-blue-50 p-4 rounded-xl mb-6 text-center font-bold text-blue-600 text-xl">{cnt} / {selClass.students.length} Present</div>
                        <div className="flex-1 overflow-y-auto space-y-3">{selClass.students.map(s=>{ const p=st[s.id]==='present'; return <div key={s.id} onClick={()=>tog(s.id)} className={`flex items-center justify-between p-4 rounded-xl border transition-all ${p?'bg-white':'bg-red-50 border-red-100'}`}><span className={`font-medium ${p?'text-slate-700':'text-red-700'}`}>{s.name}</span><div className={`w-8 h-8 rounded-full flex items-center justify-center ${p?'bg-green-500 text-white':'bg-red-500 text-white'}`}>{p?<IconCheck />:<IconX />}</div></div>})}</div>
                    </div>
                );
            }
            if (view === 'stats') {
                const tot = selClass.sessions.length;
                return (
                    <div className="max-w-md mx-auto min-h-screen px-6 pt-4 space-y-6">
                        <header className="flex items-center gap-2"><button onClick={()=>setView('detail')} className="p-2 -ml-2"><IconBack /></button><h1 className="text-2xl font-bold">Statistics</h1></header>
                        <div className="grid gap-3">{selClass.students.map(s=>{ let p=0; selClass.sessions.forEach(sess=>{if(sess.records[s.id]==='present')p++}); const pct=tot===0?0:Math.round((p/tot)*100); return <div key={s.id} className="bg-white p-4 rounded-xl border border-gray-100"><div className="flex justify-between mb-2 font-semibold"><span>{s.name}</span><span className={pct<75?"text-red-500":"text-green-600"}>{pct}%</span></div><div className="w-full bg-gray-100 h-2 rounded-full overflow-hidden"><div className={`h-full ${pct<75?"bg-red-500":"bg-green-500"}`} style={{width: `${pct}%`}}></div></div></div>})}</div>
                    </div>
                );
            }
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
